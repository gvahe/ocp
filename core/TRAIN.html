
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Training and evaluating models on OCP datasets &#8212; Open Catalyst Project Documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'core/TRAIN';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Frequently Asked Questions" href="FAQ.html" />
    <link rel="prev" title="Pretrained OCP model checkpoints" href="MODELS.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Open Catalyst Project Documentation - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Open Catalyst Project Documentation - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    ocp by Open Catalyst Project
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Installation &amp; License</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="INSTALL.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="LICENSE.html">License</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Released Datasets &amp; Models</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="datasets/oc20.html">Open Catalyst 2020 (OC20)</a></li>

<li class="toctree-l1"><a class="reference internal" href="datasets/oc22.html">Open Catalyst 2022 (OC22)</a></li>
<li class="toctree-l1"><a class="reference internal" href="datasets/odac.html">Open Direct Air Capture 2023 (ODAC23)</a></li>
<li class="toctree-l1"><a class="reference internal" href="MODELS.html">Pretrained OCP model checkpoints</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Training your own models</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Training and evaluating models on OCP datasets</a></li>



<li class="toctree-l1"><a class="reference internal" href="FAQ.html">Frequently Asked Questions</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Videos and Talks</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../videos/intro_series.html">Open Catalyst Intro Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../videos/technical_talks.html">Technical presentations</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Catalysis Tutorials</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../tutorials/intro.html">Intro and background on OCP and DFT</a></li>




<li class="toctree-l1"><a class="reference internal" href="../tutorials/OCP-introduction.html">Simple simulations using the OCP ASE calculator</a></li>




<li class="toctree-l1"><a class="reference internal" href="../tutorials/fine-tuning/fine-tuning-oxides.html">Fine tuning a model</a></li>


<li class="toctree-l1 has-children"><a class="reference internal" href="../tutorials/advanced/fine-tuning-toc.html">Advanced example: Fine-tuning</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/advanced/fine-tuning-in-python.html">Fine-tuning with Python</a></li>



<li class="toctree-l2"><a class="reference internal" href="../tutorials/advanced/embeddings.html">Working with embeddings</a></li>



<li class="toctree-l2"><a class="reference internal" href="../tutorials/advanced/mass-inference.html">Mass inference</a></li>


</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../tutorials/NRR/NRR_toc.html">Screening catalysts with OCP</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/NRR/NRR_example.html">Using OCP to enumerate adsorbates on catalyst surfaces</a></li>






<li class="toctree-l2"><a class="reference internal" href="../tutorials/NRR/NRR_example-gemnet.html">Using OCP to enumerate adsorbates on alloy catalyst surfaces</a></li>







</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../legacy_tutorials/legacy_tutorials.html">Legacy [deprecated] Tutorials</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../legacy_tutorials/OCP_Tutorial.html">Open Catalyst Project Tutorial Notebook</a></li>













<li class="toctree-l2"><a class="reference internal" href="../legacy_tutorials/data_preprocessing.html">OCP Data Preprocessing Tutorial</a></li>



<li class="toctree-l2"><a class="reference internal" href="../legacy_tutorials/data_visualization.html">OCP Data Visualization</a></li>

<li class="toctree-l2"><a class="reference internal" href="../legacy_tutorials/lmdb_dataset_creation.html">OCP LMDB Dataset Tutorial</a></li>




</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">ocpmodels documentation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../autoapi/index.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../autoapi/ocpmodels/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../autoapi/ocpmodels/common/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.common</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/ocpmodels/common/relaxation/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.common.relaxation</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/ocpmodels/common/data_parallel/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.common.data_parallel</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/ocpmodels/common/distutils/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.common.distutils</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/ocpmodels/common/flags/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.common.flags</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/ocpmodels/common/gp_utils/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.common.gp_utils</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/ocpmodels/common/hpo_utils/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.common.hpo_utils</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/ocpmodels/common/logger/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.common.logger</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/ocpmodels/common/model_registry/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.common.model_registry</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/ocpmodels/common/registry/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.common.registry</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/ocpmodels/common/transforms/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.common.transforms</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/ocpmodels/common/tutorial_utils/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.common.tutorial_utils</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/ocpmodels/common/typing/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.common.typing</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/ocpmodels/common/utils/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.common.utils</span></code></a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../autoapi/ocpmodels/datasets/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.datasets</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/ocpmodels/datasets/embeddings/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.datasets.embeddings</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/ocpmodels/datasets/_utils/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.datasets._utils</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/ocpmodels/datasets/ase_datasets/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.datasets.ase_datasets</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/ocpmodels/datasets/lmdb_database/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.datasets.lmdb_database</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/ocpmodels/datasets/lmdb_dataset/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.datasets.lmdb_dataset</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/ocpmodels/datasets/oc22_lmdb_dataset/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.datasets.oc22_lmdb_dataset</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/ocpmodels/datasets/target_metadata_guesser/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.datasets.target_metadata_guesser</span></code></a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../autoapi/ocpmodels/models/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.models</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/ocpmodels/models/equiformer_v2/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.models.equiformer_v2</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/ocpmodels/models/escn/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.models.escn</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/ocpmodels/models/gemnet/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.models.gemnet</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/ocpmodels/models/gemnet_gp/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.models.gemnet_gp</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/ocpmodels/models/gemnet_oc/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.models.gemnet_oc</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/ocpmodels/models/painn/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.models.painn</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/ocpmodels/models/scn/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.models.scn</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/ocpmodels/models/utils/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.models.utils</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/ocpmodels/models/base/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.models.base</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/ocpmodels/models/dimenet_plus_plus/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.models.dimenet_plus_plus</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/ocpmodels/models/schnet/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.models.schnet</span></code></a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../autoapi/ocpmodels/modules/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.modules</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/ocpmodels/modules/scaling/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.modules.scaling</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/ocpmodels/modules/evaluator/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.modules.evaluator</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/ocpmodels/modules/exponential_moving_average/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.modules.exponential_moving_average</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/ocpmodels/modules/loss/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.modules.loss</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/ocpmodels/modules/normalizer/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.modules.normalizer</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/ocpmodels/modules/scheduler/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.modules.scheduler</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/ocpmodels/modules/transforms/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.modules.transforms</span></code></a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../autoapi/ocpmodels/preprocessing/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.preprocessing</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/ocpmodels/preprocessing/atoms_to_graphs/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.preprocessing.atoms_to_graphs</span></code></a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../autoapi/ocpmodels/tasks/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.tasks</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/ocpmodels/tasks/task/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.tasks.task</span></code></a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../autoapi/ocpmodels/trainers/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.trainers</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-12"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/ocpmodels/trainers/base_trainer/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.trainers.base_trainer</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/ocpmodels/trainers/ocp_trainer/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ocpmodels.trainers.ocp_trainer</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Notebook execution times</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../execution_time.html">Notebook execution times</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/Open-Catalyst-Project/ocp" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/Open-Catalyst-Project/ocp/issues/new?title=Issue%20on%20page%20%2Fcore/TRAIN.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/core/TRAIN.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Training and evaluating models on OCP datasets</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Training and evaluating models on OCP datasets</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-started">Getting Started</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#oc20">OC20</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#initial-structure-to-relaxed-energy-prediction-is2re">Initial Structure to Relaxed Energy prediction (IS2RE)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#is2re-relaxations">IS2RE Relaxations</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#structure-to-energy-and-forces-s2ef">Structure to Energy and Forces (S2EF)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#training-oc20-models-with-total-energies-is2re-s2ef">Training OC20 models with total energies (IS2RE/S2EF)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overriding-yaml-config-parameters-from-the-command-line">Overriding YAML config parameters from the command line</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#initial-structure-to-relaxed-structure-is2rs">Initial Structure to Relaxed Structure (IS2RS)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-evalai-oc20-submission-files">Create EvalAI OC20 submission files</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#s2ef-is2re">S2EF/IS2RE:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#is2rs">IS2RS:</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#oc22">OC22</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#initial-structure-to-total-relaxed-energy-is2re-total">Initial Structure to Total Relaxed Energy (IS2RE-Total)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#structure-to-total-energy-and-forces-s2ef-total">Structure to Total Energy and Forces (S2EF-Total)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#joint-training">Joint Training</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-evalai-oc22-submission-files">Create EvalAI OC22 submission files</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#s2ef-total-is2re-total">S2EF-Total/IS2RE-Total:</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#using-your-own-data">Using Your Own Data</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#writing-an-lmdb">Writing an LMDB</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-an-ase-database">Using an ASE Database</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-ase-readable-files">Using ASE-Readable Files</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#single-structure-files">Single-Structure Files</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#multi-structure-files">Multi-structure Files</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="training-and-evaluating-models-on-ocp-datasets">
<h1>Training and evaluating models on OCP datasets<a class="headerlink" href="#training-and-evaluating-models-on-ocp-datasets" title="Link to this heading">#</a></h1>
<section id="getting-started">
<h2>Getting Started<a class="headerlink" href="#getting-started" title="Link to this heading">#</a></h2>
<p>The <a class="reference external" href="https://opencatalystproject.org/">Open Catalyst Project</a> consists of three distinct tasks:</p>
<ul class="simple">
<li><p>Initial Structure to Relaxed Energy prediction (IS2RE)</p></li>
<li><p>Structure to Energy and Forces (S2EF)</p></li>
<li><p>Initial Structure to Relaxed Structure (IS2RS)</p></li>
</ul>
<p>This document is a tutorial for training and evaluating models
for each of these tasks as well as generating submission files for the
<a class="reference external" href="https://eval.ai/web/challenges/challenge-page/712/overview">evaluation server hosted on EvalAI</a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">main.py</span></code> serves as the entry point to run any task. This script requires two command line
arguments at a minimum:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--mode</span> <span class="pre">MODE</span></code>: MODE can be <code class="docutils literal notranslate"><span class="pre">train</span></code>, <code class="docutils literal notranslate"><span class="pre">predict</span></code> or <code class="docutils literal notranslate"><span class="pre">run-relaxations</span></code> to train a model, make predictions
using an existing model, or run machine learning based relaxations using an existing model, respectively.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--config-yml</span> <span class="pre">PATH</span></code>: PATH is the path to a YAML configuration file. We use YAML files to supply all
parameters to the script. The <code class="docutils literal notranslate"><span class="pre">configs</span></code> directory contains a number of example config files.</p></li>
</ul>
<p>Running <code class="docutils literal notranslate"><span class="pre">main.py</span></code> directly runs the model on a single CPU or GPU if one is available:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">mode</span> <span class="n">train</span> <span class="o">--</span><span class="n">config</span><span class="o">-</span><span class="n">yml</span> <span class="n">configs</span><span class="o">/</span><span class="n">TASK</span><span class="o">/</span><span class="n">SIZE</span><span class="o">/</span><span class="n">MODEL</span><span class="o">/</span><span class="n">MODEL</span><span class="o">.</span><span class="n">yml</span>
</pre></div>
</div>
<p>If you have multiple
GPUs, you can use distributed data parallel training by running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">u</span> <span class="o">-</span><span class="n">m</span> <span class="n">torch</span><span class="o">.</span><span class="n">distributed</span><span class="o">.</span><span class="n">launch</span> <span class="o">--</span><span class="n">nproc_per_node</span><span class="o">=</span><span class="mi">8</span> <span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">distributed</span> <span class="o">--</span><span class="n">num</span><span class="o">-</span><span class="n">gpus</span> <span class="mi">8</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">torch.distributed.launch</span></code> launches multiple processes for distributed training. For more details, refer to
https://pytorch.org/docs/stable/distributed.html#launch-utility</p>
<p>If training with multiple GPUs, GPU load balancing may be used to evenly distribute a batch of variable system sizes across GPUs. Load balancing may either balance by number of atoms or number of neighbors. A <code class="docutils literal notranslate"><span class="pre">metadata.npz</span></code> file must be available in the dataset directory to take advantage of this feature. The following command will generate a  <code class="docutils literal notranslate"><span class="pre">metadata.npz</span></code> file and place it in the corresponding directory.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">scripts</span><span class="o">/</span><span class="n">make_lmdb_sizes</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">data</span><span class="o">-</span><span class="n">path</span> <span class="n">data</span><span class="o">/</span><span class="n">s2ef</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="mi">2</span><span class="n">M</span> <span class="o">--</span><span class="n">num</span><span class="o">-</span><span class="n">workers</span> <span class="mi">8</span>
</pre></div>
</div>
<p>Load balancing is activated by default (in atoms mode). To change modes you can specify the following in your config:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">optim</span><span class="p">:</span>
  <span class="n">load_balancing</span><span class="p">:</span> <span class="n">neighbors</span>
</pre></div>
</div>
<p>For more details, refer to https://github.com/Open-Catalyst-Project/ocp/pull/267.</p>
<p>If you have access to a slurm cluster, we use the <a class="reference external" href="https://github.com/facebookincubator/submitit">submitit</a> package to simplify multi-node distributed training:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">distributed</span> <span class="o">--</span><span class="n">num</span><span class="o">-</span><span class="n">gpus</span> <span class="mi">8</span> <span class="o">--</span><span class="n">num</span><span class="o">-</span><span class="n">nodes</span> <span class="mi">6</span> <span class="o">--</span><span class="n">submit</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span>
</pre></div>
</div>
<p>In the rest of this tutorial, we explain how to train models for each task.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="oc20">
<h1>OC20<a class="headerlink" href="#oc20" title="Link to this heading">#</a></h1>
<section id="initial-structure-to-relaxed-energy-prediction-is2re">
<h2>Initial Structure to Relaxed Energy prediction (IS2RE)<a class="headerlink" href="#initial-structure-to-relaxed-energy-prediction-is2re" title="Link to this heading">#</a></h2>
<p>In the IS2RE tasks, the model takes the initial structure as an input and predicts the structureâ€™s adsorption energy
in the relaxed state. To train a model for the IS2RE task, you can use the <code class="docutils literal notranslate"><span class="pre">EnergyTrainer</span></code>
Trainer and <code class="docutils literal notranslate"><span class="pre">SinglePointLmdb</span></code> dataset by specifying the following in your configuration file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">trainer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">energy</span><span class="w"> </span><span class="c1"># Use the EnergyTrainer</span>

<span class="nt">dataset</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># Train data</span>
<span class="w">  </span><span class="nt">train</span><span class="p">:</span>
<span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">Path to training data</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">normalize_labels</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="w">    </span><span class="c1"># Mean and standard deviation of energies</span>
<span class="w">    </span><span class="nt">target_mean</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-0.969171404838562</span>
<span class="w">    </span><span class="nt">target_std</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.3671793937683105</span>
<span class="w">  </span><span class="c1"># Val data (optional)</span>
<span class="w">  </span><span class="nt">val</span><span class="p">:</span>
<span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">Path to validation data</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="c1"># Test data (optional)</span>
<span class="w">  </span><span class="nt">test</span><span class="p">:</span>
<span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">Path to test data</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>You can find examples configuration files in <a class="reference external" href="https://github.com/Open-Catalyst-Project/ocp/tree/master/configs/is2re"><code class="docutils literal notranslate"><span class="pre">configs/is2re</span></code></a>.</p>
<p>To train a SchNet model for the IS2RE task on the 10k split, run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>main.py<span class="w"> </span>--mode<span class="w"> </span>train<span class="w"> </span>--config-yml<span class="w"> </span>configs/is2re/10k/schnet/schnet.yml
</pre></div>
</div>
<p>Training logs are stored in <code class="docutils literal notranslate"><span class="pre">logs/tensorboard/[TIMESTAMP]</span></code> where <code class="docutils literal notranslate"><span class="pre">[TIMESTAMP]</span></code> is
the starting time-stamp of the run. You can monitor the training process by running:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tensorboard<span class="w"> </span>--logdir<span class="w"> </span>logs/tensorboard/<span class="o">[</span>TIMESTAMP<span class="o">]</span>
</pre></div>
</div>
<p>At the end of training, the model checkpoint is stored in <code class="docutils literal notranslate"><span class="pre">checkpoints/[TIMESTAMP]/checkpoint.pt</span></code>.</p>
<p>Next, run this model on the test data:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>main.py<span class="w"> </span>--mode<span class="w"> </span>predict<span class="w"> </span>--config-yml<span class="w"> </span>configs/is2re/10k/schnet/schnet.yml<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--checkpoint<span class="w"> </span>checkpoints/<span class="o">[</span>TIMESTAMP<span class="o">]</span>/checkpoint.pt
</pre></div>
</div>
<p>The predictions are stored in <code class="docutils literal notranslate"><span class="pre">[RESULTS_DIR]/is2re_predictions.npz</span></code> and later used to create a submission file to be uploaded to EvalAI.</p>
<section id="is2re-relaxations">
<h3>IS2RE Relaxations<a class="headerlink" href="#is2re-relaxations" title="Link to this heading">#</a></h3>
<p>Alternatively, the IS2RE task may be approached by 2 methods as described in our paper:</p>
<ul>
<li><p>Single Model: Relaxed energy predictions are extracted from relaxed structures generated via ML relaxations from a single model.</p>
<ol class="arabic">
<li><p>Train a S2EF model on both energy and forces as described <a class="reference external" href="https://github.com/Open-Catalyst-Project/ocp/blob/master/TRAIN.md#structure-to-energy-and-forces-s2ef">here</a></p></li>
<li><p>Using the trained S2EF model, run ML relaxations as described <a class="reference external" href="https://github.com/Open-Catalyst-Project/ocp/blob/master/TRAIN.md#initial-structure-to-relaxed-structure-is2rs">here</a>. Ensure <code class="docutils literal notranslate"><span class="pre">traj_dir</span></code> is uniquely specified in the config as to save out the full trajectory. A sample config can be found <a class="reference external" href="https://github.com/Open-Catalyst-Project/ocp/blob/master/configs/s2ef/2M/dimenet_plus_plus/dpp_relax.yml">here</a>. ** Note ** Relaxations on the complete val/test set may take upwards of 8hrs depending on your available hardware.</p></li>
<li><p>Prepare a submission file by running the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">scripts</span><span class="o">/</span><span class="n">make_submission_file</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="nb">id</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="nb">id</span><span class="o">/</span><span class="n">traj_dir</span> \
        <span class="o">--</span><span class="n">ood</span><span class="o">-</span><span class="n">ads</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">ood_ads</span><span class="o">/</span><span class="n">traj_dir</span> <span class="o">--</span><span class="n">ood</span><span class="o">-</span><span class="n">cat</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">ood_cat</span><span class="o">/</span><span class="n">traj_dir</span> \
        <span class="o">--</span><span class="n">ood</span><span class="o">-</span><span class="n">both</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">ood_both</span><span class="o">/</span><span class="n">traj_dir</span> <span class="o">--</span><span class="n">out</span><span class="o">-</span><span class="n">path</span> <span class="n">submission_file</span><span class="o">.</span><span class="n">npz</span> <span class="o">--</span><span class="n">is2re</span><span class="o">-</span><span class="n">relaxations</span>
</pre></div>
</div>
</li>
</ol>
</li>
<li><p>Dual Model: Relaxed energy predictions are extracted from relaxed structures generated via ML relaxations from two models - one for running relaxations and one for making energy predictions.</p>
<ol class="arabic">
<li><p>Train two S2EF models, energy-only and force-only.</p></li>
<li><p>Using the trained force-only S2EF model, run ML relaxations as described previously. Ensure <code class="docutils literal notranslate"><span class="pre">traj_dir</span></code> is uniquely specified in the config as to save out the full trajectory. <strong>Note</strong> Relaxations on the complete val/test set may take upwards of 8hrs depending on your available hardware.</p></li>
<li><p>In order to make predictions via the energy-only model on the generated trajectories, LMDBs must be constructed via the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>python scripts/preprocess_relaxed.py --id path/to/id/traj_dir \
      --ood-ads path/to/ood_ads/traj_dir --ood-cat path/to/ood_cat/traj_dir \
      --ood-both path/to/ood_both/traj_dir --out-path $DIR --num-workers $NUM_WORKERS
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">$DIR</span></code> specifies the directory to save generated LMDBs. A sub-directory will be created for each of the 4 splits in <code class="docutils literal notranslate"><span class="pre">$DIR</span></code>. <code class="docutils literal notranslate"><span class="pre">$NUM_WORKERS</span></code> is the number of data preprocessing cpu workers to be used.</p>
</li>
<li><p>Update your energy-only config to point the test set to the newly generated LMDBs. Using the trained energy-only S2EF model, generate predictions via <code class="docutils literal notranslate"><span class="pre">--mode</span> <span class="pre">predict</span></code> (as you would do for the general IS2RE/S2EF case).</p></li>
<li><p>Prepare a submission file by running the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">scripts</span><span class="o">/</span><span class="n">make_submission_file</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="nb">id</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="nb">id</span><span class="o">/</span><span class="n">s2ef_predictions</span><span class="o">.</span><span class="n">npz</span> \
        <span class="o">--</span><span class="n">ood</span><span class="o">-</span><span class="n">ads</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">ood_ads</span><span class="o">/</span><span class="n">s2ef_predictions</span><span class="o">.</span><span class="n">npz</span> <span class="o">--</span><span class="n">ood</span><span class="o">-</span><span class="n">cat</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">ood_cat</span><span class="o">/</span><span class="n">s2ef_predictions</span><span class="o">.</span><span class="n">npz</span> \
        <span class="o">--</span><span class="n">ood</span><span class="o">-</span><span class="n">both</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">ood_both</span><span class="o">/</span><span class="n">s2ef_predictions</span><span class="o">.</span><span class="n">npz</span> <span class="o">--</span><span class="n">out</span><span class="o">-</span><span class="n">path</span> <span class="n">submission_file</span><span class="o">.</span><span class="n">npz</span> \
        <span class="o">--</span><span class="n">is2re</span><span class="o">-</span><span class="n">relaxations</span> <span class="o">--</span><span class="n">hybrid</span>
</pre></div>
</div>
</li>
</ol>
</li>
</ul>
</section>
</section>
<section id="structure-to-energy-and-forces-s2ef">
<h2>Structure to Energy and Forces (S2EF)<a class="headerlink" href="#structure-to-energy-and-forces-s2ef" title="Link to this heading">#</a></h2>
<p>In the S2EF task, the model takes the positions of the atoms as input and predicts the adsorption energy and per-atom
forces as calculated by DFT. To train a model for the S2EF task, you can use the <code class="docutils literal notranslate"><span class="pre">ForcesTrainer</span></code> Trainer
and <code class="docutils literal notranslate"><span class="pre">TrajectoryLmdb</span></code> dataset by specifying the following in your configuration file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">trainer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">forces</span><span class="w">  </span><span class="c1"># Use the ForcesTrainer</span>

<span class="nt">dataset</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># Training data</span>
<span class="w">  </span><span class="nt">train</span><span class="p">:</span>
<span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">Path to training data</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">normalize_labels</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="w">    </span><span class="c1"># Mean and standard deviation of energies</span>
<span class="w">    </span><span class="nt">target_mean</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-0.7586356401443481</span>
<span class="w">    </span><span class="nt">target_std</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2.981738567352295</span>
<span class="w">    </span><span class="c1"># Mean and standard deviation of forces</span>
<span class="w">    </span><span class="nt">grad_target_mean</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="w">    </span><span class="nt">grad_target_std</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2.981738567352295</span>
<span class="w">  </span><span class="c1"># Val data (optional)</span>
<span class="w">  </span><span class="nt">val</span><span class="p">:</span>
<span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">Path to validation data</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="c1"># Test data (optional)</span>
<span class="w">  </span><span class="nt">test</span><span class="p">:</span>
<span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">Path to test data</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>You can find examples configuration files in <a class="reference external" href="https://github.com/Open-Catalyst-Project/ocp/tree/master/configs/s2ef"><code class="docutils literal notranslate"><span class="pre">configs/s2ef</span></code></a>.</p>
<p>To train a SchNet model for the S2EF task on the 2M split using 2 GPUs, run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-u<span class="w"> </span>-m<span class="w"> </span>torch.distributed.launch<span class="w"> </span>--nproc_per_node<span class="o">=</span><span class="m">2</span><span class="w"> </span>main.py<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--mode<span class="w"> </span>train<span class="w"> </span>--config-yml<span class="w"> </span>configs/s2ef/2M/schnet/schnet.yml<span class="w"> </span>--num-gpus<span class="w"> </span><span class="m">2</span><span class="w"> </span>--distributed
</pre></div>
</div>
<p>Similar to the IS2RE task, tensorboard logs are stored in <code class="docutils literal notranslate"><span class="pre">logs/tensorboard/[TIMESTAMP]</span></code> and the
checkpoint is stored in <code class="docutils literal notranslate"><span class="pre">checkpoints/[TIMESTAMP]/checkpoint.pt</span></code>.</p>
<p>Next, run this model on the test data:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>main.py<span class="w"> </span>--mode<span class="w"> </span>predict<span class="w"> </span>--config-yml<span class="w"> </span>configs/s2ef/2M/schnet/schnet.yml<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--checkpoint<span class="w"> </span>checkpoints/<span class="o">[</span>TIMESTAMP<span class="o">]</span>/checkpoint.pt
</pre></div>
</div>
<p>The predictions are stored in <code class="docutils literal notranslate"><span class="pre">[RESULTS_DIR]/s2ef_predictions.npz</span></code> and later used to create a submission file to be uploaded to EvalAI.</p>
</section>
<section id="training-oc20-models-with-total-energies-is2re-s2ef">
<h2>Training OC20 models with total energies (IS2RE/S2EF)<a class="headerlink" href="#training-oc20-models-with-total-energies-is2re-s2ef" title="Link to this heading">#</a></h2>
<p>To train and validate an OC20 IS2RE/S2EF model on total energies instead of adsorption energies there are a number of required changes to the config. They include setting: <code class="docutils literal notranslate"><span class="pre">dataset:</span> <span class="pre">oc22_lmdb</span></code>, <code class="docutils literal notranslate"><span class="pre">prediction_dtype:</span> <span class="pre">float32</span></code>, <code class="docutils literal notranslate"><span class="pre">train_on_oc20_total_energies:</span> <span class="pre">True</span></code>, and <code class="docutils literal notranslate"><span class="pre">oc20_ref:</span> <span class="pre">path/to/oc20_ref.pkl</span></code> (see example below). Also, please note that our evaluation server does not currently support OC20 total energy models.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">task</span><span class="p">:</span>
<span class="w">  </span><span class="nt">prediction_dtype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">float32</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>

<span class="nt">dataset</span><span class="p">:</span>
<span class="w">  </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">oc22_lmdb</span>
<span class="w">  </span><span class="nt">train</span><span class="p">:</span>
<span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data/oc20/s2ef/train</span>
<span class="w">    </span><span class="nt">normalize_labels</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="w">    </span><span class="nt">train_on_oc20_total_energies</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="w">    </span><span class="c1"># download at https://dl.fbaipublicfiles.com/opencatalystproject/data/oc22/oc20_ref.pkl</span>
<span class="w">    </span><span class="nt">oc20_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">path/to/oc20_ref.pkl</span>
<span class="w">  </span><span class="nt">val</span><span class="p">:</span>
<span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data/oc20/s2ef/val_id</span>
<span class="w">    </span><span class="nt">train_on_oc20_total_energies</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="w">    </span><span class="nt">oc20_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">path/to/oc20_ref.pkl</span>
</pre></div>
</div>
</section>
<section id="overriding-yaml-config-parameters-from-the-command-line">
<h2>Overriding YAML config parameters from the command line<a class="headerlink" href="#overriding-yaml-config-parameters-from-the-command-line" title="Link to this heading">#</a></h2>
<p>There is some support for specifying arguments from the command line, such that
they would override any parameter from the YAML configuration file. The parser
for this relies on the <a class="reference external" href="https://github.com/Open-Catalyst-Project/ocp/blob/main/ocpmodels/common/utils.py#L357">nesting level being correctly specified using a <code class="docutils literal notranslate"><span class="pre">.</span></code>
separator</a>.</p>
<p>For example, to override the training dataset path via a command line argument:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>main.py<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--mode<span class="w"> </span>train
<span class="w">    </span>--config-yml<span class="w"> </span>configs/s2ef/2M/schnet/schnet.yml<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--dataset.train.src<span class="o">=</span>path/to/my/dataset/
</pre></div>
</div>
<p>Or to update the initial learning rate:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>main.py<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--mode<span class="w"> </span>train
<span class="w">    </span>--config-yml<span class="w"> </span>configs/s2ef/2M/schnet/schnet.yml<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--optim.lr_initial<span class="o">=</span>3e-4
</pre></div>
</div>
</section>
<section id="initial-structure-to-relaxed-structure-is2rs">
<h2>Initial Structure to Relaxed Structure (IS2RS)<a class="headerlink" href="#initial-structure-to-relaxed-structure-is2rs" title="Link to this heading">#</a></h2>
<p>In the IS2RS task the model takes as input an initial structure and predicts the atomic positions in their
final, relaxed state. This can be done by training a model to predict per-atom forces similar to the S2EF
task and then running an iterative relaxation. Although we present an iterative approach, models that directly predict relaxed states are also possible. The iterative approach IS2RS task uses the same configuration files as the S2EF task <code class="docutils literal notranslate"><span class="pre">configs/s2ef</span></code> and follows the same training scheme above.</p>
<p>To perform an iterative relaxation, ensure the following is added to the configuration files of the models you wish to run relaxations on:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Relaxation options</span>
<span class="nt">relax_dataset</span><span class="p">:</span>
<span class="w">  </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data/is2re/all/val_id/data.lmdb</span><span class="w"> </span><span class="c1"># path to lmdb of systems to be relaxed (uses same lmdbs as is2re)</span>
<span class="nt">write_pos</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="nt">relaxation_steps</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">300</span>
<span class="nt">relax_opt</span><span class="p">:</span>
<span class="w">  </span><span class="nt">maxstep</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.04</span>
<span class="w">  </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50</span>
<span class="w">  </span><span class="nt">damping</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span>
<span class="w">  </span><span class="nt">alpha</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">70.0</span>
<span class="w">  </span><span class="nt">traj_dir</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;trajectories&quot;</span><span class="w"> </span><span class="c1"># specify directory you wish to log the entire relaxations, suppress otherwise</span>
</pre></div>
</div>
<p>After training, relaxations can be run by:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>main.py<span class="w"> </span>--mode<span class="w"> </span>run-relaxations<span class="w"> </span>--config-yml<span class="w"> </span>configs/s2ef/2M/schnet/schnet.yml<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--checkpoint<span class="w"> </span>checkpoints/<span class="o">[</span>TIMESTAMP<span class="o">]</span>/checkpoint.pt
</pre></div>
</div>
<p>The relaxed structure positions are stored in <code class="docutils literal notranslate"><span class="pre">[RESULTS_DIR]/relaxed_positions.npz</span></code> and later used to create a submission file to be uploaded to EvalAI. Predicted trajectories are stored in <code class="docutils literal notranslate"><span class="pre">trajectories</span></code> directory for those interested in analyzing the complete relaxation trajectory.</p>
</section>
<section id="create-evalai-oc20-submission-files">
<h2>Create EvalAI OC20 submission files<a class="headerlink" href="#create-evalai-oc20-submission-files" title="Link to this heading">#</a></h2>
<p>EvalAI expects results to be structured in a specific format for a submission to be successful. A submission must contain results from the 4 different splits - in distribution (id), out of distribution adsorbate (ood ads), out of distribution catalyst (ood cat), and out of distribution adsorbate and catalyst (ood both). Constructing the submission file for each of the above tasks is as follows:</p>
<section id="s2ef-is2re">
<h3>S2EF/IS2RE:<a class="headerlink" href="#s2ef-is2re" title="Link to this heading">#</a></h3>
<ol class="arabic">
<li><p>Run predictions <code class="docutils literal notranslate"><span class="pre">--mode</span> <span class="pre">predict</span></code> on all 4 splits, generating <code class="docutils literal notranslate"><span class="pre">[s2ef/is2re]_predictions.npz</span></code> files for each split.</p></li>
<li><p>Run the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>make_submission_file.py<span class="w"> </span>--id<span class="w"> </span>path/to/id/file.npz<span class="w"> </span>--ood-ads<span class="w"> </span>path/to/ood_ads/file.npz<span class="w"> </span><span class="se">\</span>
--ood-cat<span class="w"> </span>path/to/ood_cat/file.npz<span class="w"> </span>--ood-both<span class="w"> </span>path/to/ood_both/file.npz<span class="w"> </span>--out-path<span class="w"> </span>submission_file.npz
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">file.npz</span></code> corresponds to the respective <code class="docutils literal notranslate"><span class="pre">[s2ef/is2re]_predictions.npz</span></code> files generated for the corresponding task. The final submission file will be written to <code class="docutils literal notranslate"><span class="pre">submission_file.npz</span></code> (rename accordingly).</p>
</li>
<li><p>Upload <code class="docutils literal notranslate"><span class="pre">submission_file.npz</span></code> to EvalAI.</p></li>
</ol>
</section>
<section id="is2rs">
<h3>IS2RS:<a class="headerlink" href="#is2rs" title="Link to this heading">#</a></h3>
<ol class="arabic">
<li><p>Ensure <code class="docutils literal notranslate"><span class="pre">write_pos:</span> <span class="pre">True</span></code> is included in your configuration file. Run relaxations <code class="docutils literal notranslate"><span class="pre">--mode</span> <span class="pre">run-relaxations</span></code> on all 4 splits, generating <code class="docutils literal notranslate"><span class="pre">relaxed_positions.npz</span></code> files for each split.</p></li>
<li><p>Run the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>make_submission_file.py<span class="w"> </span>--id<span class="w"> </span>path/to/id/relaxed_positions.npz<span class="w"> </span>--ood-ads<span class="w"> </span>path/to/ood_ads/relaxed_positions.npz<span class="w"> </span><span class="se">\</span>
--ood-cat<span class="w"> </span>path/to/ood_cat/relaxed_positions.npz<span class="w"> </span>--ood-both<span class="w"> </span>path/to/ood_both/relaxed_positions.npz<span class="w"> </span>--out-path<span class="w"> </span>is2rs_submission.npz
</pre></div>
</div>
<p>The final submission file will be written to <code class="docutils literal notranslate"><span class="pre">is2rs_submission.npz</span></code> (rename accordingly).</p>
</li>
<li><p>Upload <code class="docutils literal notranslate"><span class="pre">is2rs_submission.npz</span></code> to EvalAI.</p></li>
</ol>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="oc22">
<h1>OC22<a class="headerlink" href="#oc22" title="Link to this heading">#</a></h1>
<section id="initial-structure-to-total-relaxed-energy-is2re-total">
<h2>Initial Structure to Total Relaxed Energy (IS2RE-Total)<a class="headerlink" href="#initial-structure-to-total-relaxed-energy-is2re-total" title="Link to this heading">#</a></h2>
<p>For the IS2RE-Total task, the model takes the initial structure as input and predicts the total DFT energy of the relaxed structure. This task is more general and more challenging than the original OC20 IS2RE task that predicts adsorption energy. To train an OC22 IS2RE-Total model use the <code class="docutils literal notranslate"><span class="pre">EnergyTrainer</span></code> with the <code class="docutils literal notranslate"><span class="pre">OC22LmdbDataset</span></code> by including these lines in your configuration file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">trainer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">energy</span><span class="w"> </span><span class="c1"># Use the EnergyTrainer</span>

<span class="nt">dataset</span><span class="p">:</span>
<span class="w">  </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">oc22_lmdb</span><span class="w"> </span><span class="c1"># Use the OC22LmdbDataset</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
<p>You can find examples configuration files in <a class="reference external" href="https://github.com/Open-Catalyst-Project/ocp/tree/main/configs/oc22/is2re"><code class="docutils literal notranslate"><span class="pre">configs/oc22/is2re</span></code></a>.</p>
</section>
<section id="structure-to-total-energy-and-forces-s2ef-total">
<h2>Structure to Total Energy and Forces (S2EF-Total)<a class="headerlink" href="#structure-to-total-energy-and-forces-s2ef-total" title="Link to this heading">#</a></h2>
<p>The S2EF-Total task takes a structure and predicts the total DFT energy and per-atom forces. This differs from the original OC20 S2EF task because it predicts total energy instead of adsorption energy. To train an OC22 S2EF-Total model use the ForcesTrainer with the OC22LmdbDataset by including these lines in your configuration file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">trainer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">forces</span><span class="w">  </span><span class="c1"># Use the ForcesTrainer</span>

<span class="nt">dataset</span><span class="p">:</span>
<span class="w">  </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">oc22_lmdb</span><span class="w"> </span><span class="c1"># Use the OC22LmdbDataset</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
<p>You can find examples configuration files in <a class="reference external" href="https://github.com/Open-Catalyst-Project/ocp/tree/main/configs/oc22/s2ef"><code class="docutils literal notranslate"><span class="pre">configs/oc22/s2ef</span></code></a>.</p>
</section>
<section id="joint-training">
<h2>Joint Training<a class="headerlink" href="#joint-training" title="Link to this heading">#</a></h2>
<p>Training on OC20 total energies whether independently or jointly with OC22 requires a path to the <code class="docutils literal notranslate"><span class="pre">oc20_ref</span></code> (download link provided below) to be specified in the configuration file. These are necessary to convert OC20 adsorption energies into their corresponding total energies. The following changes in the configuration file capture these changes:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">dataset</span><span class="p">:</span>
<span class="w">  </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">oc22_lmdb</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>

<span class="nt">dataset</span><span class="p">:</span>
<span class="w">  </span><span class="nt">train</span><span class="p">:</span>
<span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data/oc20+oc22/s2ef/train</span>
<span class="w">    </span><span class="nt">normalize_labels</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="w">    </span><span class="nt">train_on_oc20_total_energies</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="w">    </span><span class="c1">#download at https://dl.fbaipublicfiles.com/opencatalystproject/data/oc22/oc20_ref.pkl</span>
<span class="w">    </span><span class="nt">oc20_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">path/to/oc20_ref.pkl</span>
<span class="w">  </span><span class="nt">val</span><span class="p">:</span>
<span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data/oc22/s2ef/val_id</span>
<span class="w">    </span><span class="nt">train_on_oc20_total_energies</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="w">    </span><span class="nt">oc20_ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">path/to/oc20_ref.pkl</span>
</pre></div>
</div>
<p>You can find an example configuration file at <a class="reference external" href="https://github.com/Open-Catalyst-Project/ocp/blob/main/configs/oc22/s2ef/base_joint.yml">configs/oc22/s2ef/base_joint.yml</a></p>
</section>
<section id="create-evalai-oc22-submission-files">
<h2>Create EvalAI OC22 submission files<a class="headerlink" href="#create-evalai-oc22-submission-files" title="Link to this heading">#</a></h2>
<p>EvalAI expects results to be structured in a specific format for a submission to be successful. A submission must contain results from the 2 different splits - in distribution (id) and out of distribution (ood). Construct submission files for the OC22 S2EF-Total/IS2RE-Total tasks as follows:</p>
<section id="s2ef-total-is2re-total">
<h3>S2EF-Total/IS2RE-Total:<a class="headerlink" href="#s2ef-total-is2re-total" title="Link to this heading">#</a></h3>
<ol class="arabic">
<li><p>Run predictions <code class="docutils literal notranslate"><span class="pre">--mode</span> <span class="pre">predict</span></code> on both the id and ood splits, generating <code class="docutils literal notranslate"><span class="pre">[s2ef/is2re]_predictions.npz</span></code> files for each split.</p></li>
<li><p>Run the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>make_submission_file.py<span class="w"> </span>--dataset<span class="w"> </span>OC22<span class="w"> </span>--id<span class="w"> </span>path/to/id/file.npz<span class="w"> </span>--ood<span class="w"> </span>path/to/ood_ads/file.npz<span class="w"> </span>--out-path<span class="w"> </span>submission_file.npz
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">file.npz</span></code> corresponds to the respective <code class="docutils literal notranslate"><span class="pre">[s2ef/is2re]_predictions.npz</span></code> files generated for the corresponding task. The final submission file will be written to <code class="docutils literal notranslate"><span class="pre">submission_file.npz</span></code> (rename accordingly). The <code class="docutils literal notranslate"><span class="pre">dataset</span></code> argument specifies which dataset is being considered â€” this only needs to be set for OC22 predictions because OC20 is the default.</p>
</li>
<li><p>Upload <code class="docutils literal notranslate"><span class="pre">submission_file.npz</span></code> to EvalAI.</p></li>
</ol>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="using-your-own-data">
<h1>Using Your Own Data<a class="headerlink" href="#using-your-own-data" title="Link to this heading">#</a></h1>
<p>There are multiple ways to train and evaluate OCP models on data other than OC20 and OC22. Writing an LMDB is the most performant option. However, ASE-based dataset formats are also included as a convenience for people with existing data who simply want to try OCP tools without needing to learn about LMDBs.</p>
<p>This tutorial will briefly discuss the basic use of these dataset formats. For more detailed information about the ASE datasets, see the <a class="reference internal" href="#ocpmodels/datasets/ase_datasets.py"><span class="xref myst">source code and docstrings</span></a>.</p>
<section id="writing-an-lmdb">
<h2>Writing an LMDB<a class="headerlink" href="#writing-an-lmdb" title="Link to this heading">#</a></h2>
<p>Storing your data in an LMDB ensures very fast random read speeds for the fastest supported throughput. This is the recommended option for the majority of OCP use cases. For more information about writing your data to an LMDB, please see the <a class="reference external" href="https://github.com/Open-Catalyst-Project/ocp/blob/main/tutorials/lmdb_dataset_creation.ipynb">LMDB Dataset Tutorial</a>.</p>
</section>
<section id="using-an-ase-database">
<h2>Using an ASE Database<a class="headerlink" href="#using-an-ase-database" title="Link to this heading">#</a></h2>
<p>If your data is already in an <a class="reference external" href="https://databases.fysik.dtu.dk/ase/ase/db/db.html">ASE Database</a>, no additional preprocessing is necessary before running training/prediction! Although the ASE DB backends may not be sufficiently high throughput for all use cases, they are generally considered â€œfast enoughâ€ to train on a reasonably-sized dataset with 1-2 GPUs or predict with a single GPU. If you want to effictively utilize more resources than this, please be aware of the potential for this bottleneck and consider writing your data to an LMDB. If your dataset is small enough to fit in CPU memory, use the <code class="docutils literal notranslate"><span class="pre">keep_in_memory:</span> <span class="pre">True</span></code> option to avoid this bottleneck.</p>
<p>To use this dataset, we will just have to change our config files to use the ASE DB Dataset rather than the LMDB Dataset:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">dataset</span><span class="p">:</span>
<span class="w">  </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ase_db</span>
<span class="w">  </span><span class="nt">train</span><span class="p">:</span>
<span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="c1"># The path/address to your ASE DB</span>
<span class="w">    </span><span class="nt">connect_args</span><span class="p">:</span>
<span class="w">      </span><span class="c1"># Keyword arguments for ase.db.connect()</span>
<span class="w">    </span><span class="nt">select_args</span><span class="p">:</span>
<span class="w">      </span><span class="c1"># Keyword arguments for ase.db.select()</span>
<span class="w">      </span><span class="c1"># These can be used to query/filter the ASE DB</span>
<span class="w">    </span><span class="nt">a2g_args</span><span class="p">:</span>
<span class="w">      </span><span class="nt">r_energy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="w">      </span><span class="nt">r_forces</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="w">      </span><span class="c1"># Set these if you want to train on energy/forces</span>
<span class="w">      </span><span class="c1"># Energy/force information must be in the ASE DB!</span>
<span class="w">    </span><span class="nt">keep_in_memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span><span class="w"> </span><span class="c1"># Keeping the dataset in memory reduces random reads and is extremely fast, but this is only feasible for relatively small datasets!</span>
<span class="w">    </span><span class="nt">include_relaxed_energy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span><span class="w"> </span><span class="c1"># Read the last structure&#39;s energy and save as &quot;y_relaxed&quot; for IS2RE-Direct training</span>
<span class="w">  </span><span class="nt">val</span><span class="p">:</span>
<span class="w">    </span><span class="nt">src</span><span class="p">:</span>
<span class="w">    </span><span class="nt">a2g_args</span><span class="p">:</span>
<span class="w">      </span><span class="nt">r_energy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="w">      </span><span class="nt">r_forces</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="w">  </span><span class="nt">test</span><span class="p">:</span>
<span class="w">    </span><span class="nt">src</span><span class="p">:</span>
<span class="w">    </span><span class="nt">a2g_args</span><span class="p">:</span>
<span class="w">      </span><span class="nt">r_energy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="w">      </span><span class="nt">r_forces</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="w">      </span><span class="c1"># It is not necessary to have energy or forces if you are just making predictions.</span>
</pre></div>
</div>
</section>
<section id="using-ase-readable-files">
<h2>Using ASE-Readable Files<a class="headerlink" href="#using-ase-readable-files" title="Link to this heading">#</a></h2>
<p>It is possible to train/predict directly on ASE-readable files. This is only recommended for smaller datasets, as directories of many small files do not scale efficiently on all computing infrastructures. There are two options for loading data with the ASE reader:</p>
<section id="single-structure-files">
<h3>Single-Structure Files<a class="headerlink" href="#single-structure-files" title="Link to this heading">#</a></h3>
<p>This dataset assumes a single structure will be obtained from each file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">dataset</span><span class="p">:</span>
<span class="w">  </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ase_read</span>
<span class="w">  </span><span class="nt">train</span><span class="p">:</span>
<span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="c1"># The folder that contains ASE-readable files</span>
<span class="w">    </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="c1"># Pattern matching each file you want to read (e.g. &quot;*/POSCAR&quot;). Search recursively with two wildcards: &quot;**/*.cif&quot;.</span>
<span class="w">    </span><span class="nt">include_relaxed_energy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span><span class="w"> </span><span class="c1"># Read the last structure&#39;s energy and save as &quot;y_relaxed&quot; for IS2RE-Direct training</span>

<span class="w">    </span><span class="nt">ase_read_args</span><span class="p">:</span>
<span class="w">      </span><span class="c1"># Keyword arguments for ase.io.read()</span>
<span class="w">    </span><span class="nt">a2g_args</span><span class="p">:</span>
<span class="w">      </span><span class="c1"># Include energy and forces for training purposes</span>
<span class="w">      </span><span class="c1"># If True, the energy/forces must be readable from the file (ex. OUTCAR)</span>
<span class="w">      </span><span class="nt">r_energy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="w">      </span><span class="nt">r_forces</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="w">    </span><span class="nt">keep_in_memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
</pre></div>
</div>
</section>
<section id="multi-structure-files">
<h3>Multi-structure Files<a class="headerlink" href="#multi-structure-files" title="Link to this heading">#</a></h3>
<p>This dataset supports reading files that each contain multiple structure (for example, an ASE .traj file). Using an index file, which tells the dataset how many structures each file contains, is recommended. Otherwise, the dataset is forced to load every file at startup and count the number of structures!</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">dataset</span><span class="p">:</span>
<span class="w">  </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ase_read_multi</span>
<span class="w">  </span><span class="nt">train</span><span class="p">:</span>
<span class="w">    </span><span class="nt">index_file: Filepath to an index file which contains each filename and the number of structures in each file. e.g.</span><span class="p">:</span>
<span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">/path/to/relaxation1.traj 200</span>
<span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">/path/to/relaxation2.traj 150</span>
<span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">...</span>

<span class="w">    </span><span class="c1"># If using an index file, the src and pattern are not necessary</span>
<span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="c1"># The folder that contains ASE-readable files</span>
<span class="w">    </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="c1"># Pattern matching each file you want to read (e.g. &quot;*.traj&quot;). Search recursively with two wildcards: &quot;**/*.xyz&quot;.</span>

<span class="w">    </span><span class="nt">ase_read_args</span><span class="p">:</span>
<span class="w">      </span><span class="c1"># Keyword arguments for ase.io.read()</span>
<span class="w">    </span><span class="nt">a2g_args</span><span class="p">:</span>
<span class="w">      </span><span class="c1"># Include energy and forces for training purposes</span>
<span class="w">      </span><span class="nt">r_energy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="w">      </span><span class="nt">r_forces</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="w">    </span><span class="nt">keep_in_memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
</pre></div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./core"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="MODELS.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Pretrained OCP model checkpoints</p>
      </div>
    </a>
    <a class="right-next"
       href="FAQ.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Frequently Asked Questions</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Training and evaluating models on OCP datasets</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-started">Getting Started</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#oc20">OC20</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#initial-structure-to-relaxed-energy-prediction-is2re">Initial Structure to Relaxed Energy prediction (IS2RE)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#is2re-relaxations">IS2RE Relaxations</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#structure-to-energy-and-forces-s2ef">Structure to Energy and Forces (S2EF)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#training-oc20-models-with-total-energies-is2re-s2ef">Training OC20 models with total energies (IS2RE/S2EF)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overriding-yaml-config-parameters-from-the-command-line">Overriding YAML config parameters from the command line</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#initial-structure-to-relaxed-structure-is2rs">Initial Structure to Relaxed Structure (IS2RS)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-evalai-oc20-submission-files">Create EvalAI OC20 submission files</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#s2ef-is2re">S2EF/IS2RE:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#is2rs">IS2RS:</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#oc22">OC22</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#initial-structure-to-total-relaxed-energy-is2re-total">Initial Structure to Total Relaxed Energy (IS2RE-Total)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#structure-to-total-energy-and-forces-s2ef-total">Structure to Total Energy and Forces (S2EF-Total)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#joint-training">Joint Training</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-evalai-oc22-submission-files">Create EvalAI OC22 submission files</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#s2ef-total-is2re-total">S2EF-Total/IS2RE-Total:</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#using-your-own-data">Using Your Own Data</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#writing-an-lmdb">Writing an LMDB</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-an-ase-database">Using an ASE Database</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-ase-readable-files">Using ASE-Readable Files</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#single-structure-files">Single-Structure Files</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#multi-structure-files">Multi-structure Files</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Open Catalyst Project
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      Â© Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>